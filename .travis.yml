language: java
os: linux
sudo: required
git:
  quiet: true
notifications:
  email: false
before_install:
  - echo $TRAVIS_BUILD_NUMBER > $TRAVIS_BUILD_DIR/src/main/resources/build.txt
after_install:
  - wget https://raw.githubusercontent.com/k3rn31p4nic/travis-ci-discord-webhook/master/send.sh
  - wget https://gist.githubusercontent.com/RDIL/d7b73601a46341ff2d0cec8d989c315d/raw/a9f1e6b771d722276e43d2ab695a51bb237516a2/deploy-hook.sh
  - wget https://gist.githubusercontent.com/Sk1er/38c81e68d25e8b6c3beb429cf923190f/raw/deploy_sk1er.sh
  - chmod +x deploy-hook.sh
  - chmod +x deploy_sk1er.sh
  - chmod +x send.sh
after_script:
  - |
      if [ $TRAVIS_TEST_RESULT = 0 ]; then
        bash ./send.sh success $WEBHOOK_URL
      else
        bash ./send.sh failure $WEBHOOK_URL
      fi
before_deploy:
  - git config --local user.name "HyperiumDeploy"
  - git config --local user.email "hyperiumclient@gmail.com"
  - git tag -a $TRAVIS_BUILD_NUMBER -m "'"$TRAVIS_COMMIT_MESSAGE"'"
  - "git push https://$GIT_TOKEN@github.com/HyperiumClient/Hyperium.git HEAD:master --follow-tags"
after_deploy:
  - bash ./deploy_sk1er.sh
  - bash ./deploy-hook.sh $CUBE_MAN
deploy:
  provider: releases
  api_key: $GIT_TOKEN
  skip_cleanup: true
  file_glob: true
  file: $TRAVIS_BUILD_DIR/build/libs/*
  on:
    repo: HyperiumClient/Hyperium
    prerelease: true
if: tag IS blank
